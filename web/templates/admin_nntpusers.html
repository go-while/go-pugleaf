{{define "admin_nntpusers"}}
<!-- NNTP Users Tab -->
<div class="tab-pane fade show active" id="nntpusers" role="tabpanel" aria-labelledby="nntpusers-tab">
  <!-- Create New NNTP User -->
  <div class="row mt-3">
      <div class="col-12">
          <div class="card">
              <div class="card-header bg-dark text-white">
                  <h5 class="card-title mb-0">ðŸ“¡ Generate NNTP User (Random Credentials)</h5>
              </div>
              <div class="card-body">
                  <form method="POST" action="/admin/nntpusers?tab=nntpusers">
                      <div class="row">
                          <div class="col-md-4">
                              <div class="mb-3">
                                  <label for="nntp_maxconns" class="form-label">Max Connections</label>
                                  <input type="number" class="form-control" id="nntp_maxconns" name="maxconns"
                                         min="1" max="10" value="1">
                              </div>
                          </div>
                          <div class="col-md-4">
                              <div class="mb-3">
                                  <label for="nntp_posting" class="form-label">Posting</label>
                                  <div class="form-check mt-2">
                                      <input class="form-check-input" type="checkbox" id="nntp_posting" name="posting">
                                      <label class="form-check-label" for="nntp_posting">
                                          Allow posting
                                      </label>
                                  </div>
                              </div>
                          </div>
                          <div class="col-md-4">
                              <div class="mb-3">
                                  <label for="nntp_web_user_id" class="form-label">Map to Web User</label>
                                  <select class="form-select" id="nntp_web_user_id" name="web_user_id">
                                      <option value="">None</option>
                                      {{range .Users}}
                                      <option value="{{.ID}}">{{.Username}} ({{.Email}})</option>
                                      {{end}}
                                  </select>
                              </div>
                          </div>
                      </div>
                      <div class="row">
                          <div class="col-12">
                              <button type="submit" class="btn btn-primary">Generate NNTP User (Random Credentials)</button>
                          </div>
                      </div>
                  </form>
              </div>
          </div>
      </div>
  </div>

  <!-- NNTP Users List -->
  <div class="row mt-3">
      <div class="col-12">
          <div class="card">
              <div class="card-header bg-dark text-white">
                  <h6 class="card-title mb-0">ðŸ“¡ NNTP Users</h6>
              </div>
              <div class="card-body">
                  {{if .NNTPUsers}}
                  <div class="table-responsive">
                      <table class="table table-striped table-hover">
                          <thead>
                              <tr>
                                  <th>ID</th>
                                  <th>Username</th>
                                  <th>Max Conns</th>
                                  <th>Posting</th>
                                  <th>Mapped User</th>
                                  <th>Active</th>
                                  <th>Last Login</th>
                                  <th>Created</th>
                                  <th>Actions</th>
                              </tr>
                          </thead>
                          <tbody>
                              {{range .NNTPUsers}}
                              <tr>
                                  <td>{{.ID}}</td>
                                  <td><strong>{{.Username}}</strong></td>
                                  <td>{{.MaxConns}}</td>
                                  <td>
                                      {{if .Posting}}
                                      <span class="badge bg-success">Yes</span>
                                      {{else}}
                                      <span class="badge bg-secondary">No</span>
                                      {{end}}
                                  </td>
                                  <td>
                                      {{if gt .WebUserID 0}}
                                      <span class="badge bg-info">User ID: {{.WebUserID}}</span>
                                      {{else}}
                                      <span class="text-muted">None</span>
                                      {{end}}
                                  </td>
                                  <td>
                                      {{if .IsActive}}
                                      <span class="badge bg-success">Active</span>
                                      {{else}}
                                      <span class="badge bg-danger">Inactive</span>
                                      {{end}}
                                  </td>
                                  <td>
                                      {{if .LastLogin}}
                                      {{.LastLogin.Format "2006-01-02 15:04"}}
                                      {{else}}
                                      <span class="text-muted">Never</span>
                                      {{end}}
                                  </td>
                                  <td>{{.CreatedAt.Format "2006-01-02 15:04"}}</td>
                                  <td>
                                    <div class="btn-group btn-group-sm" role="group">
                                    <button type="button" class="btn btn-outline-primary btn-sm"
                                        data-bs-toggle="modal" data-bs-target="#editNNTPUserModal{{.ID}}">
                                        Edit
                                    </button>
                                    {{if .IsActive}}
                                    <form method="POST" action="/admin/nntpusers/toggle?tab=nntpusers" style="display: inline;">
                                        <input type="hidden" name="id" value="{{.ID}}">
                                        <button type="submit" class="btn btn-outline-warning btn-sm">
                                            Deactivate
                                        </button>
                                    </form>
                                    {{else}}
                                    <form method="POST" action="/admin/nntpusers/enable?tab=nntpusers" style="display: inline;">
                                        <input type="hidden" name="id" value="{{.ID}}">
                                        <button type="submit" class="btn btn-outline-success btn-sm">
                                            Enable
                                        </button>
                                    </form>
                                    {{end}}
                                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                    {{if not .IsActive}}
                                    <form method="POST" action="/admin/nntpusers/delete?tab=nntpusers" style="display: inline;">
                                        <input type="hidden" name="id" value="{{.ID}}">
                                        <button type="submit" class="btn btn-outline-danger btn-sm">
                                            Delete
                                        </button>
                                    </form>
                                    {{else}}
                                    <form disabled method="POST" action="/admin/nntpusers/delete?tab=nntpusers" style="display: inline;">
                                        <form style="display: inline;">
                                            <button disabled type="submit" class="btn btn-outline-danger btn-sm">
                                                Delete
                                            </button>
                                        </form>
                                    {{end}}
                                    </div>
                                  </td>
                              </tr>

                              <!-- Edit NNTP User Modal -->
                              <div class="modal fade" id="editNNTPUserModal{{.ID}}" tabindex="-1">
                                  <div class="modal-dialog">
                                      <div class="modal-content">
                                          <div class="modal-header">                              <h5 class="modal-title">Edit NNTP User: {{.Username}}</h5>
                              <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                          </div>
                          <form method="POST" action="/admin/nntpusers/update?tab=nntpusers">
                              <div class="modal-body">
                                  <input type="hidden" name="id" value="{{.ID}}">
                                  <div class="mb-3">
                                      <label class="form-label">Username</label>
                                      <input type="text" class="form-control" value="{{.Username}}" readonly>
                                  </div>
                                                  <div class="mb-3">
                                                      <label class="form-label">New Password (leave blank to keep current)</label>
                                                      <input type="password" class="form-control" name="password" maxlength="16">
                                                  </div>
                                                  <div class="mb-3">
                                                      <label class="form-label">Max Connections</label>
                                                      <input type="number" class="form-control" name="maxconns" value="{{.MaxConns}}" min="1" max="10">
                                                  </div>
                                                  <div class="mb-3">
                                                      <div class="form-check">
                                                          <input class="form-check-input" type="checkbox" name="posting" {{if .Posting}}checked{{end}}>
                                                          <label class="form-check-label">Allow posting</label>
                                                      </div>
                                                  </div>
                                                  <div class="mb-3">
                                                      <label class="form-label">Map to Web User</label>
                                                      <select class="form-select" name="web_user_id">
                                                          <option value="">None</option>
                                                          {{range $.Users}}
                                                          <option value="{{.ID}}">
                                                              {{.Username}} ({{.Email}})
                                                          </option>
                                                          {{end}}
                                                      </select>
                                                  </div>
                                              </div>
                                              <div class="modal-footer">
                                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                                  <button type="submit" class="btn btn-primary">Update NNTP User</button>
                                              </div>
                                          </form>
                                      </div>
                                  </div>
                              </div>
                              {{end}}
                          </tbody>
                      </table>
                  </div>
                  {{else}}
                  <p class="text-muted">No NNTP users found.</p>
                  {{end}}
              </div>
          </div>
      </div>
  </div>
</div>
{{end}}
